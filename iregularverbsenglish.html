<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>English Irregular Verbs</title>
  <link rel="stylesheet" href="style.css" />
</head>

<body>
  <div class="container">
    <button onclick="toggleMenu()" class="ham">
      <img src="./img/hamburger.svg" alt="Menu" />
    </button>

    <div class="words">
      <h1>Irregular Verbs</h1>

      <div class="word">
        <p id="french"></p>
        <div class="progressbar">
          <span></span>
        </div>
      </div>

      <div class="answer">
        <p id="english"></p>
      </div>

      <div class="btn-deck">
        <button id="speakButton" type="button">
          <img src="./img/speak.png" alt="Speak" />
        </button>
        <button id="nextButton" type="button">
          <img src="./img/next.png" alt="Next" />
        </button>
      </div>

      <div class="footer">
        <ul>
          <li><a class="legal" href="./mention.html" target="_blank" rel="noopener">Legal Notice</a></li>
          <li><a class="legal" href="./cookies.html" target="_blank" rel="noopener">Cookie Policy</a></li>
          <li><a class="legal" href="./confidentialite.html" target="_blank" rel="noopener">Privacy Policy</a></li>
          <li><a class="legal" href="./condition.html" target="_blank" rel="noopener">General Terms and Conditions of Sale (GTCS)</a></li>
        </ul>
        <a href="./index.html">
          <img src="./img/logo.png" alt="Casual English" />
        </a>
      </div>
    </div>

    <button onclick="toggleDark()" class="btn-float dark-mode">
      <img src="./img/moon.svg" alt="Dark mode" />
    </button>
    <button onclick="toggleQues()" class="btn-float ques">
      <img src="./img/question.svg" alt="Help" />
    </button>

    <!-- menu -->
    <div class="menu">
      <a href="./index.html">Back to Main Page</a>
    </div>

    <!-- overlay -->
    <div class="menu-overlay" onclick="closeMenu()" aria-hidden="true"></div>

    <!-- help -->
   <!-- help -->
<div class="help">
  <h3 class="help-title">Help</h3>

  <div class="help-lang">
    <p class="help-subtitle">Choose language:</p>
    <div class="help-lang-buttons">
      <a class="help-lang-btn" href="./iregularverbsenglish.html">English</a>
      <a class="help-lang-btn" href="./iregularverbs.html">Français</a>
      <a class="help-lang-btn" href="./iregularvershindi.html">हिन्दी</a>
    </div>
  </div>

  <p class="help-text">
    1. In the settings set your phone to English
    <br><br>
    2. In the menu, choose the language
    <br><br>
    3. Press play
    <br><br>
    4. You have 2 seconds to find the answer
    <br><br>
    5. The result is displayed
    <br><br>
    6. To listen, press the speaker
    <br><br>
    7. To go to the next, press the arrow
  </p>
</div>
  </div>

  <!-- If you still use functions from script.js (toggleMenu/toggleDark/toggleQues), keep this. -->
  <script src="./script.js"></script>

  <script>
    // =====================
    // DATA
    // =====================
    const irregularVerbs = [
      { english: "be", french: "be", pastSimple: "was were", pastParticiple: "been" },
      { english: "beat", french: "beat", pastSimple: "beat", pastParticiple: "beaten" },
      { english: "become", french: "become", pastSimple: "became", pastParticiple: "become" },
      { english: "begin", french: "begin", pastSimple: "began", pastParticiple: "begun" },
      { english: "bend", french: "bend", pastSimple: "bent", pastParticiple: "bent" },
      { english: "bet", french: "bet", pastSimple: "bet", pastParticiple: "bet" },
      { english: "bite", french: "bite", pastSimple: "bit", pastParticiple: "bitten" },
      { english: "blow", french: "blow", pastSimple: "blew", pastParticiple: "blown" },
      { english: "break", french: "break", pastSimple: "broke", pastParticiple: "broken" },
      { english: "bring", french: "bring", pastSimple: "brought", pastParticiple: "brought" },
      { english: "broadcast", french: "broadcast", pastSimple: "broadcast", pastParticiple: "broadcast" },
      { english: "build", french: "build", pastSimple: "built", pastParticiple: "built" },
      { english: "burst", french: "burst", pastSimple: "burst", pastParticiple: "burst" },
      { english: "buy", french: "buy", pastSimple: "bought", pastParticiple: "bought" },
      { english: "catch", french: "catch", pastSimple: "caught", pastParticiple: "caught" },
      { english: "choose", french: "choose", pastSimple: "chose", pastParticiple: "chosen" },
      { english: "come", french: "come", pastSimple: "came", pastParticiple: "come" },
      { english: "cost", french: "cost", pastSimple: "cost", pastParticiple: "cost" },
      { english: "creep", french: "creep", pastSimple: "crept", pastParticiple: "crept" },
      { english: "cut", french: "cut", pastSimple: "cut", pastParticiple: "cut" },
      { english: "deal", french: "deal", pastSimple: "dealt", pastParticiple: "dealt" },
      { english: "dig", french: "dig", pastSimple: "dug", pastParticiple: "dug" },
      { english: "do", french: "do", pastSimple: "did", pastParticiple: "done" },
      { english: "draw", french: "draw", pastSimple: "drew", pastParticiple: "drawn" },
      { english: "drink", french: "drink", pastSimple: "drank", pastParticiple: "drunk" },
      { english: "drive", french: "drive", pastSimple: "drove", pastParticiple: "driven" },
      { english: "eat", french: "eat", pastSimple: "ate", pastParticiple: "eaten" },
      { english: "fall", french: "fall", pastSimple: "fell", pastParticiple: "fallen" },
      { english: "feed", french: "feed", pastSimple: "fed", pastParticiple: "fed" },
      { english: "feel", french: "feel", pastSimple: "felt", pastParticiple: "felt" },
      { english: "fight", french: "fight", pastSimple: "fought", pastParticiple: "fought" },
      { english: "find", french: "find", pastSimple: "found", pastParticiple: "found" },
      { english: "flee", french: "flee", pastSimple: "fled", pastParticiple: "fled" },
      { english: "fly", french: "fly", pastSimple: "flew", pastParticiple: "flown" },
      { english: "forbid", french: "forbid", pastSimple: "forbade", pastParticiple: "forbidden" },
      { english: "forget", french: "forget", pastSimple: "forgot", pastParticiple: "forgotten forgot" },
      { english: "forgive", french: "forgive", pastSimple: "forgave", pastParticiple: "forgiven" },
      { english: "freeze", french: "freeze", pastSimple: "froze", pastParticiple: "frozen" },
      { english: "get", french: "get", pastSimple: "got", pastParticiple: "gotten got" },
      { english: "give", french: "give", pastSimple: "gave", pastParticiple: "given" },
      { english: "go", french: "go", pastSimple: "went", pastParticiple: "gone" },
      { english: "grow", french: "grow", pastSimple: "grew", pastParticiple: "grown" },
      { english: "hang", french: "hang", pastSimple: "hung", pastParticiple: "hung" },
      { english: "have", french: "have", pastSimple: "had", pastParticiple: "had" },
      { english: "hear", french: "hear", pastSimple: "heard", pastParticiple: "heard" },
      { english: "hide", french: "hide", pastSimple: "hid", pastParticiple: "hidden" },
      { english: "hit", french: "hit", pastSimple: "hit", pastParticiple: "hit" },
      { english: "hold", french: "hold", pastSimple: "held", pastParticiple: "held" },
      { english: "hurt", french: "hurt", pastSimple: "hurt", pastParticiple: "hurt" },
      { english: "keep", french: "keep", pastSimple: "kept", pastParticiple: "kept" },
      { english: "kneel", french: "kneel", pastSimple: "knelt knelled", pastParticiple: "knelt kneeled" },
      { english: "know", french: "know", pastSimple: "knew", pastParticiple: "known" },
      { english: "lay", french: "lay", pastSimple: "laid", pastParticiple: "laid" },
      { english: "lead", french: "lead", pastSimple: "led", pastParticiple: "led" },
      { english: "learn", french: "learn", pastSimple: "learnt", pastParticiple: "learnt" },
      { english: "leave", french: "leave", pastSimple: "left", pastParticiple: "left" },
      { english: "lend", french: "lend", pastSimple: "lent", pastParticiple: "lent" },
      { english: "let", french: "let", pastSimple: "let", pastParticiple: "let" },
      { english: "lie", french: "lie", pastSimple: "lay", pastParticiple: "lain" },
      { english: "light", french: "light", pastSimple: "lit lighted", pastParticiple: "lit lighted" },
      { english: "lose", french: "lose", pastSimple: "lost", pastParticiple: "lost" },
      { english: "make", french: "make", pastSimple: "made", pastParticiple: "made" },
      { english: "mean", french: "mean", pastSimple: "meant", pastParticiple: "meant" },
      { english: "meet", french: "meet", pastSimple: "met", pastParticiple: "met" },
      { english: "pay", french: "pay", pastSimple: "paid", pastParticiple: "paid" },
      { english: "put", french: "put", pastSimple: "put", pastParticiple: "put" },
      { english: "read", french: "read", pastSimple: "read", pastParticiple: "read" },
      { english: "ride", french: "ride", pastSimple: "rode", pastParticiple: "ridden" },
      { english: "ring", french: "ring", pastSimple: "rang", pastParticiple: "rung" },
      { english: "rise", french: "rise", pastSimple: "rose", pastParticiple: "risen" },
      { english: "run", french: "run", pastSimple: "ran", pastParticiple: "run" },
      { english: "say", french: "say", pastSimple: "said", pastParticiple: "said" },
      { english: "see", french: "see", pastSimple: "saw", pastParticiple: "seen" },
      { english: "seek", french: "seek", pastSimple: "sought", pastParticiple: "sought" },
      { english: "sell", french: "sell", pastSimple: "sold", pastParticiple: "sold" },
      { english: "send", french: "send", pastSimple: "sent", pastParticiple: "sent" },
      { english: "set", french: "set", pastSimple: "set", pastParticiple: "set" },
      { english: "shake", french: "shake", pastSimple: "shook", pastParticiple: "shaken" },
      { english: "sew", french: "sew", pastSimple: "sewed", pastParticiple: "sewn sewed" },
      { english: "shine", french: "shine", pastSimple: "shone", pastParticiple: "shone" },
      { english: "shoot", french: "shoot", pastSimple: "shot", pastParticiple: "shot" },
      { english: "show", french: "show", pastSimple: "showed", pastParticiple: "shown" },
      { english: "shrink", french: "shrink", pastSimple: "shrank", pastParticiple: "shrunk" },
      { english: "shut", french: "shut", pastSimple: "shut", pastParticiple: "shut" },
      { english: "sing", french: "sing", pastSimple: "sang", pastParticiple: "sung" },
      { english: "sink", french: "sink", pastSimple: "sank sunk", pastParticiple: "sunk sunken" },
      { english: "sit", french: "sit", pastSimple: "sat", pastParticiple: "sat" },
      { english: "sleep", french: "sleep", pastSimple: "slept", pastParticiple: "slept" },
      { english: "slide", french: "slide", pastSimple: "slid", pastParticiple: "slid" },
      { english: "speak", french: "speak", pastSimple: "spoke", pastParticiple: "spoken" },
      { english: "spend", french: "spend", pastSimple: "spent", pastParticiple: "spent" },
      { english: "spit", french: "spit", pastSimple: "spat spit", pastParticiple: "spat spit" },
      { english: "split", french: "split", pastSimple: "split", pastParticiple: "split" },
      { english: "spread", french: "spread", pastSimple: "spread", pastParticiple: "spread" },
      { english: "spring", french: "spring", pastSimple: "sprang", pastParticiple: "sprung" },
      { english: "stand", french: "stand", pastSimple: "stood", pastParticiple: "stood" },
      { english: "steal", french: "steal", pastSimple: "stole", pastParticiple: "stolen" },
      { english: "stick", french: "stick", pastSimple: "stuck", pastParticiple: "stuck" },
      { english: "sting", french: "sting", pastSimple: "stung", pastParticiple: "stung" },
      { english: "stink", french: "stink", pastSimple: "stank", pastParticiple: "stunk" },
      { english: "strike", french: "strike", pastSimple: "struck", pastParticiple: "struck" },
      { english: "swear", french: "swear", pastSimple: "swore", pastParticiple: "sworn" },
      { english: "sweep", french: "sweep", pastSimple: "swept", pastParticiple: "swept" },
      { english: "swim", french: "swim", pastSimple: "swam", pastParticiple: "swum" },
      { english: "swing", french: "swing", pastSimple: "swung swang", pastParticiple: "swung swang" },
      { english: "take", french: "take", pastSimple: "took", pastParticiple: "taken" },
      { english: "teach", french: "teach", pastSimple: "taught", pastParticiple: "taught" },
      { english: "tear", french: "tear", pastSimple: "tore", pastParticiple: "torn" },
      { english: "tell", french: "tell", pastSimple: "told", pastParticiple: "told" },
      { english: "think", french: "think", pastSimple: "thought", pastParticiple: "thought" },
      { english: "throw", french: "throw", pastSimple: "threw", pastParticiple: "thrown" },
      { english: "understand", french: "understand", pastSimple: "understood", pastParticiple: "understood" },
      { english: "wake", french: "wake", pastSimple: "woke", pastParticiple: "woken" },
      { english: "wear", french: "wear", pastSimple: "wore", pastParticiple: "worn" },
      { english: "weep", french: "weep", pastSimple: "wept", pastParticiple: "wept" },
      { english: "win", french: "win", pastSimple: "won", pastParticiple: "won" },
      { english: "write", french: "write", pastSimple: "wrote", pastParticiple: "written" }
    ];

    // =====================
    // STATE
    // =====================
    let countdown = -1;
    let currentVerb = null;
    let intervalId = null;

    const speakButton = document.getElementById("speakButton");
    const nextButton = document.getElementById("nextButton");
    const frenchEl = document.getElementById("french");
    const englishEl = document.getElementById("english");
    const progressSpan = document.querySelector(".words .word .progressbar span");

    // =====================
    // INIT
    // =====================
    document.addEventListener("DOMContentLoaded", () => {
      // Start immediately (visual part). This is fine in Instagram WebView.
      showNewVerb();

      // Next button
      nextButton.addEventListener("click", () => showNewVerb());

      // Speak button: MUST be triggered by a real user gesture on mobile / Instagram.
      setupSpeech();
    });

    // =====================
    // FUNCTIONS
    // =====================
    function showNewVerb() {
      // Reset any running countdown
      if (intervalId) {
        clearInterval(intervalId);
        intervalId = null;
      }

      // Reset UI
      countdown = 2;
      frenchEl.textContent = "";
      englishEl.textContent = "";

      // Pick a verb
      const randomIndex = Math.floor(Math.random() * irregularVerbs.length);
      currentVerb = irregularVerbs[randomIndex];

      // Show prompt (you used "french" but values are currently English in your data)
      frenchEl.textContent = currentVerb.french;

      // Restart progress animation safely
      restartProgressAnimation((countdown + 1) * 1000);

      // Countdown then reveal answer
      intervalId = setInterval(() => {
        countdown--;
        if (countdown === -1) {
          clearInterval(intervalId);
          intervalId = null;
          englishEl.textContent =
            `${currentVerb.english} ${currentVerb.pastSimple} ${currentVerb.pastParticiple}`;
        }
      }, 1000);
    }

    function restartProgressAnimation(durationMs) {
      if (!progressSpan) return;

      // Cancel previous animation by removing/re-adding style
      progressSpan.getAnimations().forEach(anim => anim.cancel());
      progressSpan.style.width = "0%";

      // Trigger reflow so the next animation starts correctly
      // eslint-disable-next-line no-unused-expressions
      progressSpan.offsetWidth;

      progressSpan.animate(
        [{ width: "0%" }, { width: "100%" }],
        { duration: durationMs, fill: "forwards" }
      );
    }

    function setupSpeech() {
      if (!("speechSynthesis" in window) || typeof SpeechSynthesisUtterance === "undefined") {
        speakButton.disabled = true;
        speakButton.title = "Text-to-speech not supported";
        return;
      }

      speakButton.addEventListener("click", () => {
        if (!currentVerb) return;

        // iOS / Instagram WebView often needs cancel() to avoid stuck queues
        window.speechSynthesis.cancel();

        const utterance = new SpeechSynthesisUtterance(
          `${currentVerb.english}, ${currentVerb.pastSimple}, ${currentVerb.pastParticiple}`
        );

        // Use a valid BCP-47 tag (en-UK is not valid). en-GB is the common choice.
        utterance.lang = "en-GB";

        window.speechSynthesis.speak(utterance);
      });
    }

    function isInstagramWebView() {
    const ua = navigator.userAgent || "";
    return ua.includes("Instagram");
    }

    document.addEventListener("DOMContentLoaded", () => {
    const speakButton = document.getElementById("speakButton");

    if (isInstagramWebView()) {
    // Hide the speaker button entirely in Instagram
    speakButton.style.display = "none";
    }
    });

  </script>
</body>
</html>

