<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>English Irregular Verbs</title>
  <link rel="stylesheet" href="style.css" />
</head>

<body>
  <div class="container">
    <button onclick="toggleMenu()" class="ham">
      <img src="./img/hamburger.svg" alt="Menu" />
    </button>

    <div class="words">
      <h1>Irregular Verbs</h1>

      <div class="word">
        <p id="french"></p>
        <div class="progressbar">
          <span></span>
        </div>
      </div>

      <div class="answer">
        <p id="english"></p>
      </div>

      <div class="btn-deck">
        <button id="speakButton" type="button">
          <img src="./img/speak.png" alt="Speak" />
        </button>
        <button id="nextButton" type="button">
          <img src="./img/next.png" alt="Next" />
        </button>
      </div>

      <div class="footer">
        <ul>
          <li><a class="legal" href="./mention.html" target="_blank" rel="noopener">Legal Notice</a></li>
          <li><a class="legal" href="./cookies.html" target="_blank" rel="noopener">Cookie Policy</a></li>
          <li><a class="legal" href="./confidentialite.html" target="_blank" rel="noopener">Privacy Policy</a></li>
          <li><a class="legal" href="./condition.html" target="_blank" rel="noopener">General Terms and Conditions of Sale (GTCS)</a></li>
        </ul>
        <a href="./index.html">
          <img src="./img/logo.png" alt="Casual English" />
        </a>
      </div>
    </div>

    <button onclick="toggleDark()" class="btn-float dark-mode">
      <img src="./img/moon.svg" alt="Dark mode" />
    </button>
    <button onclick="toggleQues()" class="btn-float ques">
      <img src="./img/question.svg" alt="Help" />
    </button>

    <!-- menu -->
    <div class="menu">
      <a href="./index.html">Back to Main Page</a>
    </div>

    <!-- help -->
    <div class="help">
      <p>
        1. In the settings set your phone to English
        <br><br>
        2. In the menu, choose the language
        <br><br>
        3. Press play
        <br><br>
        4. You have 2 seconds to find the answer
        <br><br>
        5. The result is displayed
        <br><br>
        6. To listen, press the speaker
        <br><br>
        7. To go to the next, press the arrow
      </p>
    </div>
  </div>

  <!-- If you still use functions from script.js (toggleMenu/toggleDark/toggleQues), keep this. -->
  <script src="./script.js"></script>

  <script>
    // =====================
    // DATA
    // =====================
    const irregularVerbs = [
      { english: "be", french: "होना", pastSimple: "was were", pastParticiple: "been" },
      { english: "beat", french: "पीटना मारना", pastSimple: "beat", pastParticiple: "beaten" },
      { english: "become", french: "बनना", pastSimple: "became", pastParticiple: "become" },
      { english: "begin", french: "शुरू करना", pastSimple: "began", pastParticiple: "begun" },
      { english: "bend", french: "मोड़ना", pastSimple: "bent", pastParticiple: "bent" },
      { english: "bet", french: "शर्त लगाना", pastSimple: "bet", pastParticiple: "bet" },
      { english: "bite", french: "काटना", pastSimple: "bit", pastParticiple: "bitten" },
      { english: "blow", french: "फूंक मारना", pastSimple: "blew", pastParticiple: "blown" },
      { english: "break", french: "तोड़ना", pastSimple: "broke", pastParticiple: "broken" },
      { english: "bring", french: "लाना", pastSimple: "brought", pastParticiple: "brought" },
      { english: "broadcast", french: "प्रसारित करना", pastSimple: "broadcast", pastParticiple: "broadcast" },
      { english: "build", french: "बनाना", pastSimple: "built", pastParticiple: "built" },
      { english: "burst", french: "फटना", pastSimple: "burst", pastParticiple: "burst" },
      { english: "buy", french: "खरीदना", pastSimple: "bought", pastParticiple: "bought" },
      { english: "catch", french: "पकड़ना", pastSimple: "caught", pastParticiple: "caught" },
      { english: "choose", french: "चुनना", pastSimple: "chose", pastParticiple: "chosen" },
      { english: "come", french: "आना", pastSimple: "came", pastParticiple: "come" },
      { english: "cost", french: "लागत होना खर्च होना", pastSimple: "cost", pastParticiple: "cost" },
      { english: "creep", french: "रेंगना", pastSimple: "crept", pastParticiple: "crept" },
      { english: "cut", french: "काटना", pastSimple: "cut", pastParticiple: "cut" },
      { english: "deal", french: "सौदा करना व्यवहार करना", pastSimple: "dealt", pastParticiple: "dealt" },
      { english: "dig", french: "खोदना", pastSimple: "dug", pastParticiple: "dug" },
      { english: "do", french: "करना", pastSimple: "did", pastParticiple: "done" },
      { english: "draw", french: "चित्र बनाना खींचना", pastSimple: "drew", pastParticiple: "drawn" },
      { english: "drink", french: "पीना", pastSimple: "drank", pastParticiple: "drunk" },
      { english: "drive", french: "चलाना", pastSimple: "drove", pastParticiple: "driven" },
      { english: "eat", french: "खाना", pastSimple: "ate", pastParticiple: "eaten" },
      { english: "fall", french: "गिरना", pastSimple: "fell", pastParticiple: "fallen" },
      { english: "feed", french: "खाना देना", pastSimple: "fed", pastParticiple: "fed" },
      { english: "feel", french: "महसूस करना", pastSimple: "felt", pastParticiple: "felt" },
      { english: "fight", french: "लड़ना", pastSimple: "fought", pastParticiple: "fought" },
      { english: "find", french: "ढूँढना", pastSimple: "found", pastParticiple: "found" },
      { english: "flee", french: "भागना", pastSimple: "fled", pastParticiple: "fled" },
      { english: "fly", french: "उड़ना", pastSimple: "flew", pastParticiple: "flown" },
      { english: "forbid", french: "मना करना", pastSimple: "forbade", pastParticiple: "forbidden" },
      { english: "forget", french: "भूलना", pastSimple: "forgot", pastParticiple: "forgotten forgot" },
      { english: "forgive", french: "माफ करना", pastSimple: "forgave", pastParticiple: "forgiven" },
      { english: "freeze", french: "जमना", pastSimple: "froze", pastParticiple: "frozen" },
      { english: "get", french: "प्राप्त करना लेना", pastSimple: "got", pastParticiple: "gotten got" },
      { english: "give", french: "देना", pastSimple: "gave", pastParticiple: "given" },
      { english: "go", french: "जाना", pastSimple: "went", pastParticiple: "gone" },
      { english: "grow", french: "बढ़ना उगना", pastSimple: "grew", pastParticiple: "grown" },
      { english: "hang", french: "लटकाना झूलना", pastSimple: "hung", pastParticiple: "hung" },
      { english: "have", french: "होना", pastSimple: "had", pastParticiple: "had" },
      { english: "hear", french: "सुनना", pastSimple: "heard", pastParticiple: "heard" },
      { english: "hide", french: "छिपाना", pastSimple: "hid", pastParticiple: "hidden" },
      { english: "hit", french: "मारना", pastSimple: "hit", pastParticiple: "hit" },
      { english: "hold", french: "पकड़ना", pastSimple: "held", pastParticiple: "held" },
      { english: "hurt", french: "चोट पहुँचना दुख पहुँचना", pastSimple: "hurt", pastParticiple: "hurt" },
      { english: "keep", french: "रखना", pastSimple: "kept", pastParticiple: "kept" },
      { english: "kneel", french: "घुटने टेकना", pastSimple: "knelt knelled", pastParticiple: "knelt kneeled" },
      { english: "know", french: "जानना", pastSimple: "knew", pastParticiple: "known" },
      { english: "lay", french: "रखना बिछाना", pastSimple: "laid", pastParticiple: "laid" },
      { english: "lead", french: "मार्गदर्शन करना नेतृत्व करना", pastSimple: "led", pastParticiple: "led" },
      { english: "learn", french: "सीखना", pastSimple: "learnt", pastParticiple: "learnt" },
      { english: "leave", french: "छोड़ना", pastSimple: "left", pastParticiple: "left" },
      { english: "lend", french: "उधार देना", pastSimple: "lent", pastParticiple: "lent" },
      { english: "let", french: "देना छोड़ना", pastSimple: "let", pastParticiple: "let" },
      { english: "lie", french: "झूठ बोलना लेटना ", pastSimple: "lay", pastParticiple: "lain" },
      { english: "light", french: "जगाना जलाना", pastSimple: "lit lighted", pastParticiple: "lit lighted" },
      { english: "lose", french: "खोना", pastSimple: "lost", pastParticiple: "lost" },
      { english: "make", french: "बनाना", pastSimple: "made", pastParticiple: "made" },
      { english: "mean", french: "मतलब होना", pastSimple: "meant", pastParticiple: "meant" },
      { english: "meet", french: "मिलना", pastSimple: "met", pastParticiple: "met" },
      { english: "pay", french: "भुगतान करना पैसे देना", pastSimple: "paid", pastParticiple: "paid" },
      { english: "put", french: "रखना", pastSimple: "put", pastParticiple: "put" },
      { english: "read", french: "पढ़ना", pastSimple: "read", pastParticiple: "read" },
      { english: "ride", french: "सवारी करना चढ़ना", pastSimple: "rode", pastParticiple: "ridden" },
      { english: "ring", french: "बजना घंटी बजाना फोन करना", pastSimple: "rang", pastParticiple: "rung" },
      { english: "rise", french: "उठना उठाना ", pastSimple: "rose", pastParticiple: "risen" },
      { english: "run", french: "दौड़ना", pastSimple: "ran", pastParticiple: "run" },
      { english: "say", french: "कहना", pastSimple: "said", pastParticiple: "said" },
      { english: "see", french: "देखना", pastSimple: "saw", pastParticiple: "seen" },
      { english: "seek", french: "खोजना", pastSimple: "sought", pastParticiple: "sought" },
      { english: "sell", french: "बेचना", pastSimple: "sold", pastParticiple: "sold" },
      { english: "send", french: "भेजना", pastSimple: "sent", pastParticiple: "sent" },
      { english: "set", french: "तय करना", pastSimple: "set", pastParticiple: "set" },
      { english: "shake", french: "हिलाना", pastSimple: "shook", pastParticiple: "shaken" },
      { english: "sew", french: "सिलना", pastSimple: "sewed", pastParticiple: "sewn sewed" },
      { english: "shine", french: "पिंडली", pastSimple: "shone", pastParticiple: "shone" },
      { english: "shoot", french: "गोली मार", pastSimple: "shot", pastParticiple: "shot" },
      { english: "show", french: "दिखाओ", pastSimple: "showed", pastParticiple: "shown" },
      { english: "shrink", french: "सिकुड़ना", pastSimple: "shrank", pastParticiple: "shrunk" },
      { english: "shut", french: "बंद", pastSimple: "shut", pastParticiple: "shut" },
      { english: "sing", french: "गाओ", pastSimple: "sang", pastParticiple: "sung" },
      { english: "sink", french: "डूबना", pastSimple: "sank sunk", pastParticiple: "sunk sunken" },
      { english: "sit", french: "बैठना", pastSimple: "sat", pastParticiple: "sat" },
      { english: "sleep", french: "नींद", pastSimple: "slept", pastParticiple: "slept" },
      { english: "slide", french: "फिसलना", pastSimple: "slid", pastParticiple: "slid" },
      { english: "speak", french: "बोलना", pastSimple: "spoke", pastParticiple: "spoken" },
      { english: "spend", french: "खर्च करना", pastSimple: "spent", pastParticiple: "spent" },
      { english: "spit", french: "थूकना", pastSimple: "spat spit", pastParticiple: "spat spit" },
      { english: "split", french: "विभाजित करना", pastSimple: "split", pastParticiple: "split" },
      { english: "spread", french: "फैलाना", pastSimple: "spread", pastParticiple: "spread" },
      { english: "spring", french: "वसंत", pastSimple: "sprang", pastParticiple: "sprung" },
      { english: "stand", french: "खड़ा होना", pastSimple: "stood", pastParticiple: "stood" },
      { english: "steal", french: "चुराना", pastSimple: "stole", pastParticiple: "stolen" },
      { english: "stick", french: "चिपकना", pastSimple: "stuck", pastParticiple: "stuck" },
      { english: "sting", french: "डंक मारना", pastSimple: "stung", pastParticiple: "stung" },
      { english: "stink", french: "बदबू", pastSimple: "stank", pastParticiple: "stunk" },
      { english: "strike", french: "हड़ताल", pastSimple: "struck", pastParticiple: "struck" },
      { english: "swear", french: "कसम खाना", pastSimple: "swore", pastParticiple: "sworn" },
      { english: "sweep", french: "झाडू", pastSimple: "swept", pastParticiple: "swept" },
      { english: "swim", french: "तैरना", pastSimple: "swam", pastParticiple: "swum" },
      { english: "swing", french: "झूला", pastSimple: "swung swang", pastParticiple: "swung swang" },
      { english: "take", french: "लेना", pastSimple: "took", pastParticiple: "taken" },
      { english: "teach", french: "पढ़ाना", pastSimple: "taught", pastParticiple: "taught" },
      { english: "tear", french: "आंसू", pastSimple: "tore", pastParticiple: "torn" },
      { english: "tell", french: "कहना", pastSimple: "told", pastParticiple: "told" },
      { english: "think", french: "सोचना", pastSimple: "thought", pastParticiple: "thought" },
      { english: "throw", french: "फेंक", pastSimple: "threw", pastParticiple: "thrown" },
      { english: "understand", french: "समझना", pastSimple: "understood", pastParticiple: "understood" },
      { english: "wake", french: "जागो", pastSimple: "woke", pastParticiple: "woken" },
      { english: "wear", french: "घिसाव", pastSimple: "wore", pastParticiple: "worn" },
      { english: "weep", french: "रोना", pastSimple: "wept", pastParticiple: "wept" },
      { english: "win", french: "जीतना", pastSimple: "won", pastParticiple: "won" },
      { english: "write", french: "लिखना", pastSimple: "wrote", pastParticiple: "written" },
    ];

    // =====================
    // STATE
    // =====================
    let countdown = -1;
    let currentVerb = null;
    let intervalId = null;

    const speakButton = document.getElementById("speakButton");
    const nextButton = document.getElementById("nextButton");
    const frenchEl = document.getElementById("french");
    const englishEl = document.getElementById("english");
    const progressSpan = document.querySelector(".words .word .progressbar span");

    // =====================
    // INIT
    // =====================
    document.addEventListener("DOMContentLoaded", () => {
      // Start immediately (visual part). This is fine in Instagram WebView.
      showNewVerb();

      // Next button
      nextButton.addEventListener("click", () => showNewVerb());

      // Speak button: MUST be triggered by a real user gesture on mobile / Instagram.
      setupSpeech();
    });

    // =====================
    // FUNCTIONS
    // =====================
    function showNewVerb() {
      // Reset any running countdown
      if (intervalId) {
        clearInterval(intervalId);
        intervalId = null;
      }

      // Reset UI
      countdown = 2;
      frenchEl.textContent = "";
      englishEl.textContent = "";

      // Pick a verb
      const randomIndex = Math.floor(Math.random() * irregularVerbs.length);
      currentVerb = irregularVerbs[randomIndex];

      // Show prompt (you used "french" but values are currently English in your data)
      frenchEl.textContent = currentVerb.french;

      // Restart progress animation safely
      restartProgressAnimation((countdown + 1) * 1000);

      // Countdown then reveal answer
      intervalId = setInterval(() => {
        countdown--;
        if (countdown === -1) {
          clearInterval(intervalId);
          intervalId = null;
          englishEl.textContent =
            `${currentVerb.english} ${currentVerb.pastSimple} ${currentVerb.pastParticiple}`;
        }
      }, 1000);
    }

    function restartProgressAnimation(durationMs) {
      if (!progressSpan) return;

      // Cancel previous animation by removing/re-adding style
      progressSpan.getAnimations().forEach(anim => anim.cancel());
      progressSpan.style.width = "0%";

      // Trigger reflow so the next animation starts correctly
      // eslint-disable-next-line no-unused-expressions
      progressSpan.offsetWidth;

      progressSpan.animate(
        [{ width: "0%" }, { width: "100%" }],
        { duration: durationMs, fill: "forwards" }
      );
    }

    function setupSpeech() {
      if (!("speechSynthesis" in window) || typeof SpeechSynthesisUtterance === "undefined") {
        speakButton.disabled = true;
        speakButton.title = "Text-to-speech not supported";
        return;
      }

      speakButton.addEventListener("click", () => {
        if (!currentVerb) return;

        // iOS / Instagram WebView often needs cancel() to avoid stuck queues
        window.speechSynthesis.cancel();

        const utterance = new SpeechSynthesisUtterance(
          `${currentVerb.english}, ${currentVerb.pastSimple}, ${currentVerb.pastParticiple}`
        );

        // Use a valid BCP-47 tag (en-UK is not valid). en-GB is the common choice.
        utterance.lang = "en-GB";

        window.speechSynthesis.speak(utterance);
      });
    }

    function isInstagramWebView() {
    const ua = navigator.userAgent || "";
    return ua.includes("Instagram");
    }

    document.addEventListener("DOMContentLoaded", () => {
    const speakButton = document.getElementById("speakButton");

    if (isInstagramWebView()) {
    // Hide the speaker button entirely in Instagram
    speakButton.style.display = "none";
    }
    });

  </script>
</body>
</html>
